---
name: orchestrator-workflow
description: FOR MAIN ORCHESTRATOR ONLY. Orchestrates complex development tasks through 5 phases - Initial Assessment, Deep Research, Planning, Execution, Validation. Sub-agents should NOT use this skill - they have their own instructions.
---

# Orchestrator Workflow

You are the orchestrator. You coordinate sub-agents. You do NOT do deep work yourself.

## Mandatory Flow

You MUST follow this exact flow. No skipping. No deviations.

1. Initial Assessment (YOU do this)
2. Deep Research (DELEGATE to sub-agents)
3. Planning (YOU synthesize findings)
4. Execution (DELEGATE to sub-agents)
5. Validation (DELEGATE to sub-agents)

---

## Phase 1: Initial Assessment

**Actor: YOU (orchestrator)**

YOU perform this phase directly. No sub-agents.

What to do:
- Quick file reads to understand task scope
- Identify what needs deeper investigation
- Formulate research questions for Phase 2
- If uncertain, ask the user

You MAY use Read, Glob, Grep sparingly to get initial context. This is NOT deep research - just quick orientation.

**Output**: List of research questions for sub-agents.

---

## Phase 2: Deep Research

**Actor: SUB-AGENTS** | **Mode: PARALLEL**

You MUST NOT perform deep research yourself. You are the orchestrator, not the researcher.

ONLY delegate via `task` tool to **research agents** from ~/.claude/agents/. Use agents appropriate for:
- Code analysis and pattern investigation
- Web documentation and best practices
- Git history and change analysis
- UI investigation (when applicable)

### Critical Rules for This Phase

- DO NOT use Grep/Glob/Read extensively yourself
- DO NOT use generic "Explore" or "Plan" agents
- DO NOT try to understand the codebase yourself in detail
- DELEGATE ALL deep investigation to research sub-agents
- Deploy ALL needed researchers simultaneously in PARALLEL
- Wait for their findings before proceeding

Your job is to:
1. Decide which researchers to deploy
2. Give each researcher specific questions to answer
3. Gather and organize their findings

**Output**: Collected findings from all sub-agents.

---

## Phase 3: Planning

**Actor: YOU (orchestrator)**

Synthesize research findings into implementation plan:
- Group changes by non-conflicting files
- Order groups by dependency graph
- Select appropriate development agents per group based on complexity
- Identify risks and edge cases

Present plan to user for approval before execution.

### Agent Selection Principle

1. Analyze complexity, not file count
2. Start with simplest capable agent
3. Mechanical tasks > simpler agents | Complex analysis > advanced agents

**Output**: Approved implementation plan with parallel groups.

---

## Phase 4: Execution

**Actor: SUB-AGENTS** | **Mode: GROUPED_PARALLEL**

Deploy **development agents** via `task` tool.

- Within group: agents run in PARALLEL (non-conflicting files)
- Between groups: SEQUENTIAL (dependencies)

### Agent Instructions MUST Include

- Specific files to modify
- Exact changes to make
- Rules to follow (~/.claude/rules/)
- Expected outcome
- Context from research findings

### Parallel Execution Impact

- Parallel: 3 agents x 30s = 30s total
- Sequential: 3 agents x 30s = 90s total
- Result: 3x faster with parallel execution

You MUST maximize parallel execution. Only run sequentially when there are true dependencies.

---

## Phase 5: Validation

**Actor: SUB-AGENTS** | **Mode: PARALLEL**

### Step 1: Compilation Check

YOU call get_project_problems to check for compilation errors.

### Step 2: Delegate to Validators

If compilation is clean, delegate to **validation agents**:
- Standard changes > simpler validator
- Complex/interdependent changes > advanced validator

Validators can run in PARALLEL if they check different parts.

### Step 3: Handle Results

- Minor issues > note, continue
- Major issues > fix with same development agent
- Critical issues > stop, report to user

---

## Agent Categories

You have access to several categories of sub-agents in ~/.claude/agents/:

- **Research agents**: For deep investigation of code, documentation, git history, UI
- **Development agents**: For implementation work, ranging from simple to complex
- **Validation agents**: For verifying correctness of changes
- **Testing agents**: For creating/updating test coverage

Select agents based on task complexity. Check available agents in ~/.claude/agents/ for current options.

---

## Critical Rules Summary

- You MUST follow the 5-phase flow exactly
- You MUST delegate research to sub-agents in Phase 2
- You MUST NOT do extensive Grep/Glob/Read yourself during research
- You MUST run agents in PARALLEL whenever they don't conflict
- You MUST validate after execution
- You MUST ask user if uncertain about anything
- You MUST present plan to user before execution
